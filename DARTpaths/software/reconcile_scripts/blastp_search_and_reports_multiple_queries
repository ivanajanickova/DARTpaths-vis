
# Add blastp path and database
export PATH="$PATH:$HOME/DARTpaths/software/ncbi-blast-2.8.1+/bin"
export BLASTDB="$HOME/DARTpaths/software/blastdb"


# Create output name
name="blast_"${1}"fam"

# Do a blastp search using the initial proteins from reactome, use string_proteins as database.  
blastp -query ${1}_searches_literature/${1}_reactome.fa -db string_proteins -out ${1}_searches_blast/${name}_results_redundant.tsv \
-evalue 1e-50 -word_size 3 -outfmt 6 -max_target_seqs 5000

# Get only unique results
cut -f1,2 ${1}_searches_blast/${name}_results_redundant.tsv | sort -k2,2 -u >${1}_searches_blast/${name}_results.tsv

echo "number of raw results: $(wc -l ${1}_searches_blast/${name}_results_redundant.tsv)"
echo "number of unique results: $(wc -l ${1}_searches_blast/${name}_results.tsv)"

# Extract info from the unique results
${HOME}/DARTpaths/extract_results_of_species_from_tsv 9606 ${1}_searches_blast/${name}_results.tsv | \
${HOME}/DARTpaths/extract_protein_ids_from_tsv >${1}_searches_blast/${name}_ids_human.txt
${HOME}/DARTpaths/extract_seqs_from_tsv_and_db ${1}_searches_blast/${name}_results.tsv >${1}_searches_blast/${name}_sequences.fasta
${HOME}/DARTpaths/extract_species_counts_from_tsv ${1}_searches_blast/${name}_results.tsv >${1}_searches_blast/${name}_species_counts.txt

# Create a list of the proteins in uniprot-code
<${1}_searches_blast/${name}_results.tsv cut -f2 | cut -d"." --complement -f1 | grep -f - ${HOME}/DARTpaths/protein.aliases.v11.0.txt | \
grep "BLAST_UniProt_ID" | cut -f3 >${1}_searches_blast/${name}_uniprot.txt

# Create a list of found species and a file with counts
<${1}_searches_blast/${name}_species_counts.txt cut -f1 >${1}_searches_blast/${name}_species.txt
<${1}_searches_blast/${name}_results_redundant.tsv cut -f1 | cut -d"|" -f3 | sort | uniq -c >${1}_searches_blast/${name}_query_counts.txt
